/*
 * Synth.cpp
 *
 *  Created on: Sep 30, 2016
 *      Author: josh
 */

#include "Synth.h"

#include "SaveState.h"

namespace AtomSynth {

Synth * Synth::s_instance = nullptr;

Synth::Synth() {
	m_atomManager.m_parent = this;
	m_guiManager.m_parent = this;
	m_logManager.m_parent = this;
	m_noteManager.m_parent = this;
	m_saveManager.m_parent = this;
}

Synth::~Synth() {

}

void Synth::initialize(int sampleRate, int bufferSize) {
	auto instance = getInstance();
	AudioBuffer::setDefaultSize(bufferSize);
	AudioBuffer::setDefaultChannels(2);
	instance->getParameters().m_sampleRate = sampleRate;
	instance->getParameters().m_polyphony = 32;
	instance->getAtomManager().setup();
	instance->getGuiManager().setup();
	instance->getLogManager().setup();
	instance->getNoteManager().setup();
	instance->getSaveManager().setup();
	//Only load the default patch if there isn't already another patch loaded.
	if(instance->getAtomManager().getAtoms().size() == 0) {
		instance->getAtomManager().loadSaveState(AtomSynth::SaveState("[[0.000000:[[-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:]][[225.000000:115.000000:][0.000000:]]][1.000000:[[3.000000:0.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:]][[226.000000:511.000000:][1.000000:]]][12.000000:[[0.000000:1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:]][[253.000000:248.000000:][1.000000:[1.000000:2.000000:][0.000000:2.000000:][1.000000:2.000000:][0.000000:2.000000:][0.000000:2.000000:][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]]]]][10.000000:[[0.000000:0.000000:][2.000000:0.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:][-1.000000:-1.000000:]][[226.000000:374.000000:][2.000000:[2.000000:][1.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:][-1.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[0.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-1.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:0.000000:1.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-4.000000:4.000000:so:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-100.000000:100.000000:sc:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-100.000000:100.000000:sc:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][0.000000:0.000000:-12.000000:12.000000:ss:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]][1.000000:0.000000:-2.000000:2.000000:s:[-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:][-1.000000:0.000000:1.000000:]]]]]]"));
	}
	info("Initialization complete");
}

} /* namespace AtomSynth */
